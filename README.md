# Simmani Runtime Power Modeling

This repo contains Simmani's core implementation as well as its simple examples.

## Preliminaries

* Power modeling is implemented with Python, which resides in `simmani`.
* All Scala code is for example designs generated by Chisel:
  - `GCD`: the Euclide's algorithm for the greatest common divisor (GCD) of two numbers. A.k.a. hello world of hardware.
  - `Stack`: hardware implementation of stack.
  - `Risc`: simple RISC machine with flip-flop-based memories.
  - `RiscSRAM`: simple RISC machine with SRAMs.
  - `mini`: [RISC-V mini](https://github.com/ucb-bar/riscv-mini.git), a 3-stage RISC-V pipeline.
* Each command is executed as follows:
   ```
  scons --<design> <command>
  ```
  `<design>` is one of examples available above, which is `mini` by default. For example, if you want to generate verilog for `GCD`, run: `scons --GCD rtl-v`.
* All CAD tools were run with [HAMMER](https://github.com/ucb-bar/hammer.git). Due to the NDA, we cannot release code in `tools/hammer-cad-plugins` and `tools/hammer-adept-plugins`.
* Instead, we provide pre-generated power traces in `power`. RISC-V mini's power traces are available as [a tarball](https://github.com/Simmani/riscv-mini-power-traces.git) due to their sizes.

## Prerequisites
* [SBT](scala-sbt.org)
* Python3
* Python packages: [`scons`](https://scons.org), `numpy`, `scipy`, `matplotlib`, [`scikit-learn`](https://scikit-learn.org)
  ```
  pip3 install [--user] <package>
  ```
* Synopsys VCS

## Step 1: Getting Started
```
git clone https://github.com/Simmani/simmani.git
cd simmani
./setup.sh # initialize submodules
```

## Step 2: Generating Verilog
```
scons --<design> rtl-v
```

## Step 3: Running RTL Simulation for VCDs
```
scons --<design> run-testers
```

## Step 4: Training Power Models with Pre-generated Power Traces
```
scons --<design> simmani-train
```

## Step 5: Test Power Models with Pre-generated Power Traces
```
scons --<design> simmani-test
```
Power training and test results are available in `power/<design>/simmani`.
